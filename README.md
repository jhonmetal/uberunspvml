# UberH3 Anomaly Detection - Proyecto Integral

## üöÄ Descripci√≥n General
Este proyecto implementa un sistema completo para la detecci√≥n de anomal√≠as en la demanda de Uber NYC, abarcando desde el backend MLOps hasta el frontend web y la integraci√≥n con AWS Lambda. Utiliza machine learning no supervisado (Isolation Forest), arquitectura hexagonal (Ports & Adapters), y pr√°cticas modernas de despliegue y visualizaci√≥n.

---

## üèõÔ∏è Arquitectura General
El sistema est√° dividido en varios componentes principales:
- **Backend MLOps**: Detecci√≥n de anomal√≠as, ingenier√≠a de features, almacenamiento y tracking de modelos.
- **API REST**: Servidor FastAPI para exponer endpoints de predicci√≥n, m√©tricas y salud.
- **Dashboard**: Visualizaci√≥n en tiempo real con Streamlit.
- **Webapp**: Frontend para usuarios finales, con landing page y dashboard interactivo.
- **AWS Lambda**: Backend serverless para integraci√≥n y despliegue escalable.
- **Docker & CI/CD**: Contenerizaci√≥n y automatizaci√≥n de despliegue.

---

## üì¶ Estructura de Carpetas
- `anomaly_detector/`: N√∫cleo de negocio, adaptadores, API y dashboard.
- `webapp/`: Frontend y backend para la aplicaci√≥n de usuario y developer.
- `deployment/`: Dockerfiles, scripts de despliegue y configuraci√≥n.
- `data/`: Datos crudos y procesados.
- `config/`: Configuraci√≥n de features y modelos.

---

## üìê Diagrama de Componentes (Mermaid)
```mermaid
graph TD
    subgraph MLOps
        AD[Anomaly Detection]
        FE[Feature Engineering]
        SVC[Services]
        ML[MLflow Tracking]
        STG[Storage Adapter]
        MET[Metrics Adapter]
    end
    subgraph API
        APISRV[FastAPI Server]
    end
    subgraph Dashboard
        DASH[Streamlit Dashboard]
    end
    subgraph Webapp
        FRONT[Landing Page]
        USERAPP[App Usuario]
        DEVAPP[App Developer]
    end
    subgraph AWS
        LAMBDA[AWS Lambda]
        S3[S3 Buckets]
    end
    AD --> FE
    FE --> SVC
    SVC --> ML
    SVC --> STG
    SVC --> MET
    APISRV --> SVC
    DASH --> APISRV
    FRONT --> USERAPP
    USERAPP --> APISRV
    DEVAPP --> APISRV
    LAMBDA --> APISRV
    LAMBDA --> S3
    APISRV --> ML
    APISRV --> MET
```

---

## üåê Alcance de Arquitecturas
### Hexagonal & DDD
- **Dominio desacoplado**: Toda la l√≥gica de negocio vive en `domain/`.
- **Adaptadores**: Implementan puertos para almacenamiento, tracking, m√©tricas y API.
- **Aplicaci√≥n**: Orquestaci√≥n y exposici√≥n de endpoints.

### AWS & Lambda
- **Despliegue serverless**: Backend Python en AWS Lambda usando Docker.
- **Almacenamiento S3**: Conectores para leer y escribir datos en buckets S3.
- **Integraci√≥n CI/CD**: Automatizaci√≥n de despliegue y monitoreo.

### Docker & DevOps
- **Contenerizaci√≥n**: Dockerfiles para API, dashboard y backend Lambda.
- **Orquestaci√≥n**: Docker Compose para levantar todos los servicios localmente.
- **Scripts**: Batch y Bash para despliegue multiplataforma.

---

## üñ•Ô∏è Aplicaci√≥n de Usuario
- **Landing Page**: Interfaz web amigable para acceso y visualizaci√≥n.
- **Dashboard**: Visualizaci√≥n de tendencias, anomal√≠as y salud del sistema.
- **API REST**: Endpoints para predicci√≥n, m√©tricas y consulta de modelos.

## üë®‚Äçüíª Aplicaci√≥n de Developers
- **Backend extensible**: Arquitectura hexagonal para f√°cil integraci√≥n de nuevos adaptadores y servicios.
- **MLOps**: Tracking de experimentos, versionado de features y modelos.
- **Documentaci√≥n**: Diagramas y gu√≠as en `docs/` y archivos fuente.

---

## üõ†Ô∏è Despliegue y Ejecuci√≥n
1. **Instalar dependencias**: `pip install -r requirements.txt`
2. **Configurar par√°metros**: Editar archivos YAML en `config/`.
3. **Levantar servicios**: Ejecutar `start-docker.bat` (Windows) o `start-docker.sh` (Linux/Mac).
4. **Acceder a servicios**:
   - FastAPI: [http://localhost:8000](http://localhost:8000)
   - Dashboard: [http://localhost:8506](http://localhost:8506)
   - MLflow UI: [http://localhost:5000](http://localhost:5000)
5. **Despliegue en AWS Lambda**: Usar Dockerfile espec√≠fico y subir a AWS.

---

## üìö Buenas Pr√°cticas
- L√≥gica de negocio desacoplada y testeable.
- Versionado y auditor√≠a de modelos y features.
- Seguridad y compliance en todos los componentes.
- Automatizaci√≥n CI/CD y monitoreo continuo.

---

## üìñ Referencias y Documentaci√≥n
- Diagramas y detalles en `anomaly_detector/docs/`
- Gu√≠a r√°pida en `anomaly_detector/README.md`
- Documentaci√≥n de backend y frontend en `webapp/`

---

Para dudas o contribuciones, revisa los archivos fuente y la documentaci√≥n incluida en cada m√≥dulo.

---

## Buenos H√°bitos de Desarrollo
- Mantener la rama principal (`main`) siempre funcional y documentada  
- Crear ramas para nuevas funcionalidades o experimentos y generar Pull Requests para revisi√≥n de c√≥digo  
- Documentar cada m√≥dulo y funci√≥n en el c√≥digo fuente  
- Facilitar la reproducci√≥n de resultados agregando ejemplos de uso y muestras de datos en el README

---

## Escalabilidad
Adoptando arquitecturas modernas facilita alcanzar niveles de escalabilidad horizontal y vertical para mejorar la adaptaci√≥n a diferentes tama√±o de operaciones, desde peque√±as startups hasta operadores de gran magnitud en servicios de taxi por aplicativo en grandes ciudades. La estructura hexagonal permite a futuro la incorporaci√≥n de nuevos algoritmos de detecci√≥n, que incluyen m√©todos de aprendizaje profundo y t√©cnicas de conjunto, sin alterar las operaciones ya establecidas, esto puede ser de utilidad para la integraci√≥n con sistemas de Internet de las Cosas incorporarando datos obtenidos de sensores de tr√°fico, la conexi√≥n con sistemas de administraci√≥n de flotas, y la adaptaci√≥n a diferentes formas de transporte (bicicletas, motocicletas, transporte p√∫blico). Esta capacidad de adaptaci√≥n arquitect√≥nica sit√∫a al sistema como un caso de uso robusto para la evoluci√≥n continua de las necesidades de movilidad en la ciudad. 
En resumen, nuestro proyecto demuestra que la adopci√≥n de t√©cnicas avanzadas de ML, el uso de estructuras arquitect√≥nicas modernas y la adopci√≥n de m√©todos operacionales innovadores se pueden aplicar con √©xito a un sector crucial como del de transporte de taxi por aplicaci√≥n en urbes de tr√°fico masivo. La combinaci√≥n sin√©rgica del algoritmo Isolation Forest, la estructura hexagonal, los fundamentos de DDD y las t√©cnicas MLOps produce una soluci√≥n integral que no solo atiende problemas t√©cnicos espec√≠ficos, sino que tambi√©n establece un esquema de trabajo replicable para futuras innovaciones en sistemas de transporte inteligente. En resumen, podemos afirmar que la contribuci√≥n principal se enfoca en demostrar que la integraci√≥n detallada de estas tecnolog√≠as y metodolog√≠as puede producir sistemas de identificaci√≥n de anomal√≠as que al mismo tiempo son exactos, escalables, mantenibles y operativamente factibles para aplicaciones esenciales de transporte urbano en el entorno real, y que han sido desarrolladas en clase durante el semestre.

---

## Futuras Mejoras
- **Cambio a una arquitectura de big data y transmisi√≥n en tiempo real.**
  La posibilidad de escalar aplicaciones de ML hacia big data es fundamental; por tanto, la incorporaci√≥n de soluciones que permitan gestionar voluminosas cantidades en tiempo real debe ser considerada. Apache Kafka es una soluci√≥n de c√≥digo abierto que permite manejar millones de eventos, ofreciendo habilidades para consumir datos con latencias menores a 100 ms. Una arquitectura sugerida abarcar√≠a: productores Kafka incorporados en aplicativos m√≥viles y sistemas en veh√≠culos que puedan publicar eventos de localizaci√≥n, inicio/fin de viaje y m√©tricas operativas; consumidores expertos que manejan flujo de datos para diversas situaciones de uso as√≠ como sistemas de almacenamiento distribuido utilizando tecnolog√≠as como Apache HDFS o Delta Lake.
- **Integraci√≥n con Databricks**
  La incorporaci√≥n de Databricks como plataforma unificada de an√°lisis y aprendizaje autom√°tico significar√≠a un avance cualitativo en las habilidades del sistema Databricks Structured Streaming (DSS) facilita el manejo de flujo de datos con latencias de cientos de milisegundos, habilitando la detecci√≥n de anomal√≠as en tiempo real. Elementos como Auto Loader para la automatizaci√≥n de la ingesta incremental desde fuentes de datos variables, Delta Live Tables (DLT) para la creaci√≥n de l√≠neas de datos declarativas que gestionan tanto datos en batch como en streaming, MLflow integrado para la administraci√≥n integral del ciclo de vida de modelos, desde la experimentaci√≥n hasta la implementaci√≥n en producci√≥n, as√≠ como Unity Catalog para la gesti√≥n de datos y modelos a nivel corporativo.
- **T√©cnicas Avanzadas de Escalabilidad del Modelo**
  La evoluci√≥n hacia arquitecturas de microservicios permitir√≠a escalabilidad granular de diferentes componentes del sistema de detecci√≥n de anomal√≠as. La implementaci√≥n de una arquitectura de microservicios ML permite el escalamiento independiente de servicios de ingreso de datos, procesamiento e inferencia seg√∫n demanda espec√≠fica. Como estrategias de escalabilidad tendr√≠amos: escalamiento horizontal autom√°tico mediante Kubernetes Horizontal Pod Autoscaler (HPA) para manejar picos de demanda; escalamiento vertical din√°mico usando Vertical Pod Autoscaler (VPA) para modelos que requieren recursos computacionales intensivos; distribuci√≥n de carga inteligente mediante balanceadores que consideran la capacidad espec√≠fica de cada instancia de modelo, as√≠ como optimizaci√≥n de runtime usando runtimes de alto rendimiento como TensorRT u ONNX Runtime para reducir latencias de inferencia.

---

## Arquitectura Futura: Kappa Streaming y MLOps
La siguiente arquitectura ilustra c√≥mo el sistema puede evolucionar para recibir eventos en tiempo real desde m√∫ltiples fuentes, procesar datos con Databricks Streaming y MLOps, e integrar modelos adicionales (clima, precios, tr√°fico, etc.) para entregar valor log√≠stico en tiempo real.

```mermaid
flowchart LR
    subgraph Fuentes_Eventos
        MOVIL[App M√≥vil]
        VEHICULO[Sensores Veh√≠culo]
        CLIMA[API Clima]
        TRAFICO[API Tr√°fico]
        PRECIOS[API Precios]
    end
    subgraph Ingesta
        KAFKA[Kafka Cluster]
    end
    subgraph Procesamiento
        DATABRICKS[Databricks Streaming]
        DLT[Delta Live Tables]
        ML_MODELS[Modelos ML/AI]
        ANOMALY[Detector Anomal√≠as]
    end
    subgraph MLOps
        MLflow[MLflow Tracking]
        Unity[Unity Catalog]
    end
    subgraph Consumo
        API_REALTIME[API Real-Time]
        DASH_EMPRESA[Dashboard Empresa]
        SISTEMAS[Otros Sistemas Log√≠stica]
    end
    MOVIL --> KAFKA
    VEHICULO --> KAFKA
    CLIMA --> KAFKA
    TRAFICO --> KAFKA
    PRECIOS --> KAFKA
    KAFKA --> DATABRICKS
    DATABRICKS --> DLT
    DLT --> ML_MODELS
    ML_MODELS --> ANOMALY
    ANOMALY --> API_REALTIME
    ANOMALY --> DASH_EMPRESA
    ANOMALY --> SISTEMAS
    ML_MODELS --> MLflow
    ML_MODELS --> Unity
    DLT --> MLflow
    DLT --> Unity
```

---

## Licencia y Contacto
- **Licencia:** Commons Clause + MIT / Apache 2.0
- **Equipo:**
  - [Jhonathan Pauca](mailto:jhonathan.pauca@unmsm.edu.pe), [jhonmetal](https://github.com/jhonmetal/)
  - [Fernando Flores](mailto:fernando.floresr@unmsm.edu.pe), [fnfloresra](https://github.com/fnfloresra)
  - [Melissa Rodriguez](mailto:melissa.rodriguezs@unmsm.edu.pe), [Melissadrrs](https://github.com/Melissadrrs)
  - [Heber Hualpa](mailto:heber.hualpa@unmsm.edu.pe), [hheber](https://github.com/hheber/)
  - [Marco Candia](mailto:marco.candia@unmsm.edu.pe)
